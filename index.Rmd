---
title: "Shiny Dashboard"
output:
  html_document:
    highlight: textmate
---

```{r echo = FALSE, message=FALSE}
library(shiny)
library(shinydashboard)

knitr::opts_chunk$set(collapse = TRUE, comment = "##")

# Print HTML tags as HTML text
knit_print.shiny.tag <- function(x, ...) {
  as.character(x)
}

# Shrink .png file, and optionally rescale it
shrink <- function(filename, scale = NULL) {
  if (!is.null(scale)) {
    system2('convert', args = c(filename, '-scale', scale, filename))
  }
  system2('optipng', filename)
}
```

The **shinydashboard** package is used for creating dashboards like the one below.

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/dashboard/', 'images/dashboard.png',
  delay=1, vheight=800, cliprect = "viewport"
)
shrink('images/dashboard.png', scale = "50%")
#"
```

![Dashboard](images/dashboard.png)


## Basics

A dashboard has three parts: a header, a sidebar, and a body. Here's the most minimal possible UI for a dashboard page.



```{r eval=FALSE}
## ui.R ##
library(shiny)
library(shinydashboard)

dashboardPage(
  dashboardHeader(),
  dashboardSidebar(),
  dashboardBody()
)
```


You can quickly view it by embedding it in a single-file app:

```{r eval=FALSE}
## app.R ##
ui <- dashboardPage(
  dashboardHeader(),
  dashboardSidebar(),
  dashboardBody()
)

server <- function(input, output) { }

shinyApp(ui, server)
```

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/blank_dashboard/', 'images/blank_dashboard.png',
  delay=1, vheight=300)
shrink('images/blank_dashboard.png', scale = "75%")
```

![Blank dashboard](images/blank_dashboard.png)


## Background: Shiny and HTML

To understand how these parts work together, we first need to take a step back and understand how a Shiny UI is built, and how it relates to the HTML of a web page.

The HTML tag functions in Shiny return objects that can be rendered as HTML. For example:

```{r}
# A basic div
div(class = "my-class", "Div content")

# Nested HTML tags
div(class = "my-class", p("Paragraph text"))
```

Some functions return more complex HTML, and they insulate you, the user, from having to know all the ins and outs of the HTML required to do things like create a text input or a sidebar:

```{r}
textInput("Id", "Label")


sidebarPanel(
  div("First div"),
  div("Second div")
)
```

The UI for a Shiny app is built out of these pieces of HTML. The **shinydashboard** package provides a set of functions designed to create HTML that will generate a dashboard.

## Dashboard overview

The `dashboardPage()` function expects three components: a header, sidebar, and body:

```{r eval=FALSE}
dashboardPage(
  dashboardHeader(),
  dashboardSidebar(),
  dashboardBody()
)
```

For more complicated apps, splitting app into pieces can make it more readable:

```{r eval=FALSE}
header <- dashboardHeader()

sidebar <- dashboardSidebar()

body <- dashboardBody()

dashboardPage(header, sidebar, body)
```

Now we'll look at each of the three main components of a **shinydashboard**.

### Header

A header can have a title and dropdown menus. Here's an example:

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/menus/', 'images/header.png',
  delay=1, vwidth=780, selector="header")
shrink('images/header.png', scale = "75%")
```

![Header](images/header.png)

Setting the title is simple; just use the `title` argument:

```{r eval=FALSE}
dashboardHeader(title = "My Dashboard")
```

The dropdown menus are generated by the `dropdownMenu()` function. There are three types of menus, and each one must be populated with a corresponding type of item.

| Type           | Item function        |
|----------------|----------------------|
| `message`      | `messageItem()`      |
| `notification` | `notificationItem()` |
| `task`         | `taskItem()`         |


#### Message menus

A messages menu looks like this:

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/menus/', 'images/menu-messages.png',
  delay=0.5, vwidth=780,
  selector = c(".messages-menu", ".messages-menu .dropdown-menu"),
  eval = "casper.then(function() {
    this.click('.messages-menu a.dropdown-toggle');
    this.wait(500);
  });"
)
shrink('images/menu-messages.png', scale = "75%")
#"
```

![Messages menu](images/menu-messages.png)


A `messageItem` contained in a message menu needs values for `from` and `message`. You can also control the icon and a notification time string. By default, the icon is a silhouette of a person. ([Read more about icons](icons.html)) The time string can be any text. For example, it could be a relative date/time like `"5 minutes"`, `"today"`, or `"12:30pm yesterday"`, or an absolute time, like `"2014-12-01 13:45"`.

```{r eval=FALSE}
dropdownMenu(type = "messages",
  messageItem(
    from = "Sales Dept",
    message = "Sales are steady this month."
  ),
  messageItem(
    from = "New User",
    message = "How do I register?",
    icon = icon("question"),
    time = "13:45"
  ),
  messageItem(
    from = "Support",
    message = "The new server is ready.",
    icon = icon("life-ring"),
    time = "2014-12-01"
  )
)
```


#### Notification menus

This is what a notification menu looks like:

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/menus/', 'images/menu-notifications.png',
  delay=0.5, vwidth=780,
  selector = c(".notifications-menu", ".notifications-menu .dropdown-menu"),
  eval = "casper.then(function() {
    this.click('.notifications-menu a.dropdown-toggle');
    this.wait(500);
  });"
)
shrink('images/menu-notifications.png', scale = "75%")
#"
```

![Notifications menu](images/menu-notifications.png)

A `notificationItem` contained in a notification contains a text notification. You can also control the icon and the status color. The possible statuses are listed in `?validStatuses`.

```{r eval=FALSE}
dropdownMenu(type = "notifications",
  notificationItem(
    text = "5 new users today",
    icon("users")
  ),
  notificationItem(
    text = "12 items delivered",
    icon("truck"),
    status = "success"
  ),
  notificationItem(
    text = "Server load at 86%",
    icon = icon("exclamation-triangle"),
    status = "warning"
  )
)
```


#### Task menus

This is a task menu:

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/menus/', 'images/menu-tasks.png',
  delay=0.5, vwidth=780,
  selector = c(".tasks-menu", ".tasks-menu .dropdown-menu"),
  eval = "casper.then(function() {
    this.click('.tasks-menu a.dropdown-toggle');
    this.wait(500);
  });"
)
shrink('images/menu-tasks.png', scale = "75%")
#"
```

![Tasks menu](images/menu-tasks.png)

Task items have a progress bar and a text label. You can also specify the color of the bar. Valid colors are listed in `?validColors`.

```{r eval=FALSE}
dropdownMenu(type = "tasks", badgeStatus = "success",
  taskItem(value = 90, color = "green",
    "Documentation"
  ),
  taskItem(value = 17, color = "aqua",
    "Project X"
  ),
  taskItem(value = 75, color = "yellow",
    "Server deployment"
  ),
  taskItem(value = 80, color = "red",
    "Overall project"
  )
)
```


### Sidebar

A sidebar is typically used for quick navigation. It can contain menu items that behave like tabs in a `tabPanel`, as well as Shiny inputs, like sliders and text inputs.

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/sidebar/', 'images/sidebar.png',
  delay=0.5, vwidth=1000,
  selector = c(".header > a.logo", ".sidebar"),
  expand = c(0, 10, 10, 0),
  eval = "casper.then(function() {
    this.click('ul.sidebar-menu > li.treeview > a');
    this.wait(500);
  });"
)
shrink('images/sidebar.png', scale = "75%")
#"
```

![Sidebar](images/sidebar.png)


#### Sidebar menu items

Links in the sidebar can be used like `tabPanel`s from Shiny. That is, when you click on a link, it will display different content in the body of the dashboard. Here is an example of a simple tabPanel:

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/sidebar-tabs/', 'images/sidebar-tabs.png',
  delay=1, vwidth=1000,
  cliprect = c(0, 0, 800, 300)
)
shrink('images/sidebar-tabs.png', scale = "75%")
#"
```

![Tabs](images/sidebar-tabs.png)

When the user clicks on one of the menu items, it switches content in the main body:

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/sidebar-tabs/', 'images/sidebar-tabs-2.png',
  delay=0.5, vwidth=1000,
  cliprect = c(0, 0, 800, 300),
  eval = "casper.then(function() {
    this.click('ul.sidebar-menu > li > a[href=\"#shiny-tab-widgets\"]');
    this.wait(500);
  });"
)
shrink('images/sidebar-tabs-2.png', scale = "75%")
#"
```

![Tabs](images/sidebar-tabs-2.png)


The menu items are put in `sidebarMenu()` as follows. To match up a `menuItem` with a `tabItem`, make sure that they have matching values for `tabName`. 

```{r eval=FALSE}
## ui.R ##
sidebar <- dashboardSidebar(
  sidebarMenu(
    menuItem("Dashboard", tabName = "dashboard", icon = icon("dashboard")),
    menuItem("Widgets", icon = icon("th"), tabName = "widgets",
             badgeLabel = "new", badgeColor = "green")
  )
)

body <- dashboardBody(
  tabItems(
    tabItem(tabName = "dashboard",
      h2("Dashboard tab content")
    ),

    tabItem(tabName = "widgets",
      h2("Widgets tab content")
    )
  )
)

# Put them together into a dashboardPage
dashboardPage(
  dashboardHeader(title = "Simple tabs"),
  sidebar,
  body
)
```

`menuItem`s have an option icon, which is created by the `icon()` function from Shiny. ([More information](icons.html) about using icons.) They also have an optional badge, with `badgeLabel` and `badgeColor`.

A `menuItem` can do other things besides control tabs; it can also contain a link to external content, if you supply a value for `href`. By default, these external links open in a new browser tab or window; this can be controlled with the `newtab` option.

```{r eval=FALSE}
  menuItem("Source code", icon = icon("file-code-o"), 
           href = "https://github.com/rstudio/shinydashboard/")
```


#### Inputs in the sidebar

A sidebar can also contain ordinary inputs, like `sliderInput`s and `textInput`s.

```{r eval=FALSE, echo=FALSE}
webshot::appshot('_apps/sidebar-inputs/', 'images/sidebar-inputs.png',
  delay=1, vwidth=1000,
  selector = c(".header > a.logo", ".sidebar"),
  expand = c(0, 10, 10, 0)
)
shrink('images/sidebar-inputs.png', scale = "75%")
#"
```

![Sidebar inputs](images/sidebar-inputs.png)

**shinydashboard** also includes a special type of input, a `sidebarSearchForm`, which is on top in the screenshot above. This is essentially a specially formatted text input and and actionButton which appears as a magnifying glass icon.

```{r eval=FALSE}
  sidebarSearchForm(textId = "searchText", buttonId = "searchButton",
                    label = "Search...")
```

For this search form, the corresponding values in the server-side code would be `input$searchText` and `input$searchBotton`.

### Body
